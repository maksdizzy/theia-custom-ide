{"version":3,"file":"application-shell.js","sources":["../../../src/frontend/layout/application-shell.ts"],"sourcesContent":["import '@/frontend/style/application-shell.less';\n\nimport {\n    ApplicationShell as TheiaApplicationShell,\n    DockPanel,\n    FrontendApplication as TheiaFrontendApplication,\n    FrontendApplicationContribution,\n    SidePanelHandlerFactory,\n    TheiaSplitPanel,\n    Widget,\n    type Layout\n} from '@theia/core/lib/browser';\n\nimport { TheiaDockPanel } from '@theia/core/lib/browser/shell/theia-dock-panel';\nimport { ElementExt } from '@theia/core/shared/@lumino/domutils';\nimport { injectable, postConstruct, type interfaces } from '@theia/core/shared/inversify';\n\nimport { FrontendApplication } from './frontend-application';\nimport { ShellInitContribution } from './shell-init-contribution';\nimport { SidePanelHandler } from './side-panel-handler';\n\n\nexport function initApplicationShell({ bind, rebind }: { bind: interfaces.Bind; rebind: interfaces.Rebind }): void {\n    // Rebind application shell\n    rebind(TheiaApplicationShell).to(ApplicationShell).inSingletonScope();\n\n    // Rebind frontend application\n    rebind(TheiaFrontendApplication).to(FrontendApplication).inSingletonScope();\n\n    // Shell init contribution\n    bind(ShellInitContribution).toSelf().inSingletonScope();\n    bind(FrontendApplicationContribution).toService(ShellInitContribution);\n\n    // Side panel handler\n    bind(SidePanelHandler).toSelf();\n    rebind(SidePanelHandlerFactory).toAutoFactory(SidePanelHandler);\n}\n\n@injectable()\nexport class ApplicationShell extends TheiaApplicationShell {\n    @postConstruct()\n    protected init(): void {\n        // Disable right / bottom panels (for dragging)\n        this.options = {\n            leftPanel: {\n                ...this.options.leftPanel,\n                initialSizeRatio: 0.25, // 25% of window width\n            },\n            bottomPanel: {\n                ...this.options.bottomPanel,\n                emptySize: 0,\n                expandDuration: 0,\n                initialSizeRatio: 0.2, // 20% of window height\n            },\n            rightPanel: {\n                ...this.options.rightPanel,\n                emptySize: 0,\n                expandThreshold: 0,\n                initialSizeRatio: 0,\n            },\n        };\n\n        super.init();\n        this.restrictDragging();\n    }\n\n    // NOTE: Right now is left :D\n    getInsertionOptions(options?: TheiaApplicationShell.WidgetOptions) {\n        if (options?.area === 'right') {\n            options.area = 'left';\n        }\n\n        return super.getInsertionOptions(options);\n    }\n\n    // NOOP, dragging has been disabled\n    override handleEvent(event: Event): void {\n        switch (event.type) {\n            case 'lm-dragenter':\n            case 'lm-dragleave':\n            case 'lm-dragover':\n            case 'lm-drop':\n                return;\n        }\n\n        return super.handleEvent(event);\n    }\n\n    /**\n     * Restrict dragging from/to bottom panel\n     */\n    protected restrictDragging(): void {\n        const proto = TheiaDockPanel.prototype as any;\n\n        if (proto._patchedDropBlocker) {\n            return;\n        }\n\n        const originalHandleEvent = proto.handleEvent;\n        const originalShowOverlay = proto._showOverlay;\n        const originalAddWidget = proto.addWidget;\n\n        proto.handleEvent = function(event: Event & { source?: TheiaDockPanel }): any {\n            const el = this.node;\n            const toSidePanel = !!el.closest('.theia-side-panel');\n            const toBottomPanel = !!el.closest('[id=\"theia-bottom-content-panel\"]');\n\n            // @ts-ignore\n            const isNotFromDockPanel = !event.source;\n\n            // @ts-ignore\n            const fromBottomPanel = !!(event.source?.id === 'theia-bottom-content-panel');\n\n            // Don't allow to drag from outside of the dock panel (allow only dragging between dock panels)\n            if (isNotFromDockPanel) {\n                return;\n            }\n\n            // Any kind of dragging has been disabled for bottom panel\n            if (fromBottomPanel || toBottomPanel) {\n                return;\n            }\n\n            // Cant drop to side panels\n            if (toSidePanel && ['lm-dragenter', 'lm-dragleave', 'lm-dragover', 'lm-drop'].includes(event.type)) {\n                return;\n            }\n\n            return originalHandleEvent.call(this, event);\n        };\n\n        // Don't allow to show overlay on top/bottom of the dock panel\n        proto._showOverlay = function(this: DockPanel, clientX: number, clientY: number): string {\n            const zone = originalShowOverlay.call(this, clientX, clientY) as string;\n            const overlay = this.overlay;\n\n            if (['widget-top', 'widget-bottom', 'root-top', 'root-bottom', 'widget-tab'].includes(zone)) {\n                const box = ElementExt.boxSizing(this.node);\n\n                overlay.show({\n                    top: box.paddingTop,\n                    left: box.paddingLeft,\n                    right: box.paddingRight,\n                    bottom: box.paddingBottom,\n                });\n\n                return 'widget-all';\n            }\n\n            return zone;\n        };\n\n        proto.addWidget = function(\n            widget: Widget,\n            options?: DockPanel.IAddOptions\n        ): void {\n            if (options?.mode === 'split-top' || options?.mode === 'split-bottom') {\n                options.mode = 'tab-after';\n            }\n\n            return originalAddWidget.call(this, widget, options);\n        };\n\n        proto._patchedDropBlocker = true;\n    }\n\n    /**\n     * Create a custom layout for the application shell\n     */\n    protected createLayout(): Layout {\n        const SPACING = 6;\n\n        const bottomSplitLayout = this.createSplitLayout(\n            [this.mainPanel, this.bottomPanel],\n            [1, 0],\n            { orientation: 'vertical', spacing: SPACING }\n        );\n        const panelForBottomArea = new TheiaSplitPanel({ layout: bottomSplitLayout });\n\n        panelForBottomArea.id = 'theia-bottom-split-panel';\n\n        const leftRightSplitLayout = this.createSplitLayout(\n            [this.leftPanelHandler.container, panelForBottomArea, this.rightPanelHandler.container],\n            [0, 1, 0],\n            { orientation: 'horizontal', spacing: SPACING }\n        );\n        const mainIDEPanel = new TheiaSplitPanel({ layout: leftRightSplitLayout });\n\n        mainIDEPanel.id = 'theia-main-ide-panel';\n\n        return this.createBoxLayout(\n            [this.topPanel, mainIDEPanel, this.statusBar],\n            [0, 1, 0],\n            { direction: 'top-to-bottom', spacing: 0 }\n        );\n    }\n\n    //     const panelForBottomArea = new SplitPanel({\n    //         layout: this.createSplitLayout(\n    //             [this.mainPanel, this.bottomPanel],\n    //             [1, 0],\n    //             { orientation: 'vertical', spacing: 0 }\n    //         ),\n    //     });\n\n    //     panelForBottomArea.id = 'theia-bottom-split-panel';\n\n    //     // Main part (leftPanel, mainPanel, rightPanel)\n    //     const editorSplitPanel = new SplitPanel({\n    //         layout: this.createSplitLayout(\n    //             [this.leftPanelHandler.container, panelForBottomArea, this.rightPanelHandler.container],\n    //             [0, 1, 0],\n    //             { orientation: 'horizontal', spacing: 0 }\n    //         ),\n    //     });\n\n    //     editorSplitPanel.id = 'theia-editor-split-panel';\n\n    //     // NOTE For styling purposes\n    //     this.codeIdeWidget = new BoxPanel({\n    //         layout: this.createBoxLayout([this.topPanel, editorSplitPanel, this.statusBar], [0, 1, 0], { spacing: 0 }),\n    //     });\n\n    //     this.codeIdeWidget.node.classList.add('theia-main-ide-inner');\n\n    //     this.mainIdeContainer = new BoxPanel({\n    //         layout: this.createBoxLayout([this.codeIdeWidget], [1], { spacing: 0 }),\n    //     });\n\n    //     this.mainIdeContainer.id = 'theia-main-ide-panel';\n    //     this.mainIdeContainer.node.classList.add('theia-main-ide-panel');\n\n    //     return this.createBoxLayout([this.mainIdeContainer], [1], { spacing: 0 });\n    // }\n\n    /**\n     * Create an object that describes the current shell layout. This object may contain references\n     * to widgets; these need to be transformed before the layout can be serialized.\n     */\n    // override getLayoutData(): TheiaApplicationShell.LayoutData {\n    //     return super.getLayoutData();\n    // }\n\n    /**\n     * Apply a shell layout that has been previously created with `getLayoutData`.\n     */\n    // override async setLayoutData(layoutData: TheiaApplicationShell.LayoutData): Promise<void> {\n    //     await super.setLayoutData(layoutData);\n    // }\n\n    /**\n     * Adjusts the size of the given area in the application shell.\n     */\n    // override resize(size: number, area: ApplicationShellArea): void {\n    //     return super.resize(size, area);\n    // }\n\n    /**\n     * Expand the named side panel area. This makes sure that the panel is visible, even if there\n     * are no widgets in it. If the panel is already visible, nothing happens. If the panel is currently\n     * collapsed (see `collapsePanel`) and it contains widgets, the widgets are revealed that were\n     * visible before it was collapsed.\n     */\n    // override expandPanel(area: ApplicationShellArea): void {\n    //     return super.expandPanel(area);\n    // }\n\n    /**\n     * Collapse the named side panel area. This makes sure that the panel is hidden,\n     * increasing the space that is available for other shell areas.\n     */\n    // override async collapsePanel(area: ApplicationShellArea): Promise<void> {\n    //     return super.collapsePanel(area);\n    // }\n\n    // override isExpanded(area: ApplicationShellArea): boolean {\n    //     return super.isExpanded(area);\n    // }\n\n    // override getCurrentWidget(area: ApplicationShellArea): Widget | undefined {\n    //     return super.getCurrentWidget(area);\n    // }\n\n    // override getWidgets(area: ApplicationShellArea): Widget[] {\n    //     return super.getWidgets(area);\n    // }\n\n    // override async addWidget(widget: Widget, options?: Readonly<TheiaApplicationShell.WidgetOptions>): Promise<void> {\n    //     return super.addWidget(widget, options);\n    // }\n}\n"],"names":["initApplicationShell","bind","rebind","TheiaApplicationShell","ApplicationShell","TheiaFrontendApplication","FrontendApplication","ShellInitContribution","FrontendApplicationContribution","SidePanelHandler","SidePanelHandlerFactory","options","event","proto","TheiaDockPanel","originalHandleEvent","originalShowOverlay","originalAddWidget","el","toSidePanel","toBottomPanel","isNotFromDockPanel","fromBottomPanel","clientX","clientY","zone","overlay","box","ElementExt","widget","bottomSplitLayout","panelForBottomArea","TheiaSplitPanel","leftRightSplitLayout","mainIDEPanel","__decorateClass","postConstruct","injectable"],"mappings":"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"}